(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{452:function(t,e,i){},472:function(t,e,i){"use strict";var a=i(452);i.n(a).a},473:function(t,e,i){},494:function(t,e,i){"use strict";var a=i(2),s=i(437),r=i.n(s),n=i(115),o=i.n(n);const c={},u={};const l={},d={};function h(t){return`${m(Math.floor(t/60))}:${m(Math.floor(t%60))}`}function m(t){return(t=Number(t))!=t?"00":t>9?t:"0"+t}let p=new a.a({data:()=>({id:null})});var v={props:{music:{type:Object,required:!0}},data:()=>({isLoading:!0,info:{},playUrl:"",canPlay:!1,playing:!1,paused:!1,currentTime:0,duration:0,volume:.6,context:null,analyser:null,bufferLength:null,dataArray:null,canvasWidth:256,canvasHeight:20,canvasCtx:null,gradient:null,audio:null,eventBus:p}),computed:{id(){return this.music.id},origin(){return this.music.origin},src(){return`https://music.163.com/song/media/outer/url?id=${this.id}.mp3`},albumPic(){return this.info&&this.info.al&&this.info.al.picUrl},name(){return this.info&&this.info.name||""},artist(){return(this.info&&this.info.ar||[]).map(t=>t.name).join("/")},currentTimeText(){return h(this.currentTime)},durationTimeText(){return h(this.duration)},pacePercent(){return(this.currentTime/this.duration*100).toFixed(2)+"%"}},watch:{"eventBus.id"(t){t!==this._uid&&(this.uniqPlayerIdSeted=!1,this.reset())}},methods:{initAudio(){let t=document.createElement("audio");t.crossOrigin="anonymous",t.oncanplaythrough=()=>{this.canPlay=!0,this.duration=t.duration},t.src=this.playUrl,t.volume=.6,this.audio=t},initAudioContext(){if(this.contextInited)return;AudioContext=AudioContext||webkitAudioContext;let t=this.context=new AudioContext,e=t.createMediaElementSource(this.audio),i=this.analyser=t.createAnalyser();e.connect(i),i.connect(t.destination),i.fftSize=256;let a=this.bufferLength=i.frequencyBinCount;this.dataArray=new Uint8Array(a);this.contextInited=!0},initCanvas(){if(this.canvasInited)return;let{canvasWidth:t,canvasHeight:e}=this,i=this.canvasCtx=this.$refs.canvas.getContext("2d"),a=this.gradient=i.createLinearGradient(0,e,t,e);for(let t=0;t<=5;t++)a.addColorStop(""+.2*t,r()({format:"rgba",alpha:.7}));i.lineWidth=2,this.canvasInited=!0},draw(){this.reqId=requestAnimationFrame(this.draw);let{analyser:t,bufferLength:e,dataArray:i,canvasWidth:a,canvasHeight:s,gradient:r,canvasCtx:n}=this;t.getByteFrequencyData(i),n.clearRect(0,0,a,s),n.beginPath();let o=0,c=.8*e,u=a/c;for(let t=0;t<c;t++){let e=s-i[t]/256*s;0===t?n.moveTo(o,e):n.lineTo(o,e),o+=u}n.strokeStyle=r,n.stroke(),n.closePath()},startDraw(){this.draw()},stopDraw(){this.reqId&&cancelAnimationFrame(this.reqId)},clearDraw(){let{canvasCtx:t,canvasWidth:e,canvasHeight:i}=this;t&&t.clearRect(0,0,e,i)},reset(){this.audio.pause(),this.audio.currentTime=0,this.stopDraw(),this.clearDraw(),this.playing=!1,this.paused=!1},playOrPause(){this.canPlay&&(this.initAudioContext(),this.uniqPlayerIdSeted||(p.id=this._uid,this.uniqPlayerIdSeted=!0),!this.playing||this.paused?(this.playing=!0,this.paused=!1,this.audio.onended=()=>{this.reset()},this.audio.ontimeupdate=t=>{this.currentTime=this.audio.currentTime},this.audio.play(),this.initCanvas(),this.startDraw()):(this.paused=!0,this.audio.pause(),this.stopDraw()))},setProgress({offsetX:t,currentTarget:e}){let i=t/e.clientWidth*this.duration;this.audio.currentTime=i},setVolume(t){this.audio.volume=t,this.volume=t}},mounted(){(function(t=""){if(!t)return Promise.reject();if(c[t])return Promise.resolve(c[t]);if(u[t])return u[t];let e=o.a.get("http://musicapi.leanapp.cn/song/detail",{params:{ids:t}}).then(({status:e,data:i})=>(delete u[t],200==e&&i?(i.songs.forEach(t=>{c[t.id]=t}),Promise.resolve(c[t])):Promise.reject(res)));return u[t]=e,e})(this.id).then(t=>{this.isLoading=!1,this.info=t}),function(t=""){if(!t)return Promise.reject();if(l[t])return Promise.resolve(l[t]);if(d[t])return d[t];let e=o.a.get("http://musicapi.leanapp.cn/music/url?id="+t).then(({status:e,data:i})=>{if(delete d[t],200==e&&i){let e=i.data&&i.data[0];return l[t]=e.url,Promise.resolve(e.url)}return Promise.reject()});return d[t]=e,e}(this.id).then(t=>{this.playUrl=t,this.initAudio()})},beforeDestroy(){this.audio&&(this.audio.pause(),this.stopDraw(),this.audio.oncanplaythrough=null,this.audio.onended=null,this.audio.ontimeupdate=null,this.audio=null)}},f=(i(472),i(6)),g=Object(f.a)(v,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"music-player-wrapper",class:{playing:t.playing,paused:t.paused}},[i("div",{staticClass:"progress-bottom-bar",on:{click:t.setProgress}},[i("div",{staticClass:"progress-pace",style:{width:t.pacePercent}})]),t._v(" "),i("img",{staticClass:"music-album-pic",attrs:{src:t.albumPic,alt:t.name+" - "+t.artist}}),t._v(" "),i("div",{staticClass:"music-info"},[i("div",{staticClass:"music-info-inner"},[i("span",{staticClass:"song-name",attrs:{title:t.name}},[t._v(t._s(t.name))]),t._v(" - "),i("span",{staticClass:"artist-name",attrs:{title:t.artist}},[t._v(t._s(t.artist))]),t._v(" "),i("span",{staticClass:"song-name",attrs:{title:t.name}},[t._v(t._s(t.name))]),t._v(" - "),i("span",{staticClass:"artist-name",attrs:{title:t.artist}},[t._v(t._s(t.artist))])])]),t._v(" "),i("div",{staticClass:"music-operations-wrapper"},[i("div",{staticClass:"music-play-btn",class:{toPause:t.playing&&!t.paused,toPlay:!t.playing||t.paused},on:{click:t.playOrPause}},[i("div",{staticClass:"music-btn-1"}),t._v(" "),i("div",{staticClass:"music-btn-2"})]),t._v(" "),i("div",{staticClass:"progress-bar",style:{width:t.canvasWidth+"px",height:t.canvasHeight+"px"}},[i("canvas",{ref:"canvas",staticClass:"music-wave",attrs:{width:t.canvasWidth,height:t.canvasHeight}}),t._v(" "),i("div",{staticClass:"progress-bar-inner"},[i("div",{staticClass:"progress-text"},[t._v(t._s(t.currentTimeText)+" / "+t._s(t.durationTimeText))])])]),t._v(" "),i("div",{staticClass:"music-volume"},[i("div",{staticClass:"volume-wrapper"},t._l(5,(function(e){var a;return i("div",{key:e,staticClass:"volume-rate",class:(a={},a["rate"+e]=!0,a.covered=t.volume>=(.2*e).toFixed(1),a),on:{click:function(i){return t.setVolume(.2*e)}}})})),0)])])])}),[],!1,null,null,null);e.a=g.exports},506:function(t,e,i){"use strict";var a=i(473);i.n(a).a},532:function(t,e,i){"use strict";i.r(e);var a=i(494),s=i(114),r={name:"RecordHead",components:{MusicPlayer:a.a},computed:{$frontmatter(){return this.$page.frontmatter},$topics(){return this.$frontmatter.topics||[]},date(){let{date:t}=this.$frontmatter,e=new Date(t);return Object(s.a)(e,"yyyy-MM-dd")}},methods:{focus(t){this.$emit("focusTopic",t)}}},n=(i(506),i(6)),o={components:{RecordHead:Object(n.a)(r,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"main-div record-head"},[i("div",{staticClass:"item-inner"},[i("div",{staticClass:"record-date",attrs:{title:t.date}},[t._v(t._s(t.date))]),t._v(" "),t.$frontmatter.music?i("div",{staticClass:"record-music-wrapper"},[i("MusicPlayer",{attrs:{music:t.$frontmatter.music}})],1):t._e(),t._v(" "),i("div",{staticClass:"record-image-wrapper"},t._l(t.$frontmatter.image,(function(t){return i("div",{key:t,staticClass:"record-image-inner"},[i("img",{staticClass:"record-image",attrs:{src:t,"data-original":t}})])})),0),t._v(" "),i("div",{staticClass:"record-content"},[t._v(t._s(t.$frontmatter.content||""))])])])}),[],!1,null,"38077210",null).exports}},c=Object(n.a)(o,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"record"},[e("RecordHead"),this._v(" "),e("article",{staticClass:"main-div"},[e("Content",{key:this.$page.path,staticClass:"page-content content"})],1)],1)}),[],!1,null,null,null);e.default=c.exports}}]);